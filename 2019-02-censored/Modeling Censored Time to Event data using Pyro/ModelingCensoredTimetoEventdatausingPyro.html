<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=cGvuclDC_Z1vE_cnVEU6Ae_NZQ7StBcqH_vXVqoPMX0');.lst-kix_trzo8vq1t2jb-2>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-2,lower-roman) ") "}ol.lst-kix_trzo8vq1t2jb-5.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-5 0}.lst-kix_trzo8vq1t2jb-8>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-8}.lst-kix_trzo8vq1t2jb-0>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-0,decimal) ") "}.lst-kix_trzo8vq1t2jb-4>li:before{content:"(" counter(lst-ctn-kix_trzo8vq1t2jb-4,lower-latin) ") "}.lst-kix_trzo8vq1t2jb-3>li:before{content:"(" counter(lst-ctn-kix_trzo8vq1t2jb-3,decimal) ") "}.lst-kix_trzo8vq1t2jb-5>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-5}ol.lst-kix_trzo8vq1t2jb-0.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-0 0}.lst-kix_trzo8vq1t2jb-1>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-1,lower-latin) ") "}ol.lst-kix_trzo8vq1t2jb-8.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-8 0}.lst-kix_trzo8vq1t2jb-0>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-0}ol.lst-kix_trzo8vq1t2jb-1.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-1 0}ol.lst-kix_trzo8vq1t2jb-8{list-style-type:none}.lst-kix_trzo8vq1t2jb-4>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-4}ol.lst-kix_trzo8vq1t2jb-7{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-6{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-3.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-3 0}ol.lst-kix_trzo8vq1t2jb-5{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-4{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-3{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-2{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-1{list-style-type:none}.lst-kix_trzo8vq1t2jb-7>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-7}ol.lst-kix_trzo8vq1t2jb-0{list-style-type:none}ol.lst-kix_trzo8vq1t2jb-6.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-6 0}.lst-kix_trzo8vq1t2jb-1>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-1}ol.lst-kix_trzo8vq1t2jb-4.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-4 0}.lst-kix_trzo8vq1t2jb-6>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-6}.lst-kix_trzo8vq1t2jb-3>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-3}ol.lst-kix_trzo8vq1t2jb-2.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-2 0}.lst-kix_trzo8vq1t2jb-8>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-8,lower-roman) ". "}.lst-kix_trzo8vq1t2jb-7>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-7,lower-latin) ". "}.lst-kix_trzo8vq1t2jb-6>li:before{content:"" counter(lst-ctn-kix_trzo8vq1t2jb-6,decimal) ". "}.lst-kix_trzo8vq1t2jb-2>li{counter-increment:lst-ctn-kix_trzo8vq1t2jb-2}ol.lst-kix_trzo8vq1t2jb-7.start{counter-reset:lst-ctn-kix_trzo8vq1t2jb-7 0}.lst-kix_trzo8vq1t2jb-5>li:before{content:"(" counter(lst-ctn-kix_trzo8vq1t2jb-5,lower-roman) ") "}ol{margin:0;padding:0}table td,table th{padding:0}.c5{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#f8f8f8;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c28{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:96.8pt;border-top-color:#000000;border-bottom-style:solid}.c15{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:81pt;border-top-color:#000000;border-bottom-style:solid}.c8{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:109.5pt;border-top-color:#000000;border-bottom-style:solid}.c25{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:66pt;border-top-color:#000000;border-bottom-style:solid}.c23{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:114.8pt;border-top-color:#000000;border-bottom-style:solid}.c26{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c10{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c19{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c9{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c24{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c18{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;text-align:left}.c4{border-spacing:0;border-collapse:collapse;margin-right:auto}.c12{background-color:#f8f8f8;font-family:"Consolas";color:#008080;font-weight:400}.c1{background-color:#f8f8f8;font-family:"Consolas";color:#333333;font-weight:400}.c13{background-color:#f8f8f8;font-family:"Consolas";color:#990000;font-weight:700}.c0{background-color:#f8f8f8;font-family:"Consolas";color:#dd1144;font-weight:400}.c7{background-color:#f8f8f8;font-family:"Consolas";color:#333333;font-weight:700}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c3{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c14{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c6{orphans:2;widows:2;height:11pt}.c22{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c21{margin-left:36pt;padding-left:0pt}.c11{orphans:2;widows:2}.c29{border:1px solid black;margin:5px}.c27{padding:0;margin:0}.c20{font-weight:700}.c16{height:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c22"><p class="c18 title" id="h.q516hgjmpi4"><span class="c26">Modeling Censored Time to Event Data using Pyro</span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">Hesen Peng </span></p><h1 class="c24" id="h.2md24fmqnjn0"><span class="c19">What is censored time to event data and why bother? </span></h1><p class="c3 c11"><span class="c2">Censored time to event data might be the most prevalent, yet dramatically overlooked problem in the tech industry. Almost every customer experience related problems will verge on modeling with censored time to event data. Also, time to event modeling is the critical component towards modeling user lifetime values. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">For example, at Uber, we are interested in investigating the time it takes for a rider to make a second trip after his / her first trip with Uber. Some riders just don&rsquo;t ride as often. As a result, we might not be able to observe his / her second ride at the time of data analysis, </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">Similar situations exist in other companies and industries. For example, a eCommerce site might be interested in the recurring purchase pattern of customers. Yet due to the diverse pattern of customer behavior, the company might not be able to observe all recurring purchases for all customers. This results in censored data. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">For another example, an advertising company might be interested in the recurring ad clicking behavior of its users. Due to the distinct interest of each user, the company might not be able to observe all users who have clicked making another click. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>To put this in a mathematical form, in modeling censored time to event data, for each individual of interest indexed by </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 4.00px; height: 10.67px;"><img alt="" src="images/image19.png" style="width: 4.00px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">, we might observe data in the following form: </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 48.00px; height: 16.00px;"><img alt="" src="images/image16.png" style="width: 48.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>Here </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 13.33px; height: 13.33px;"><img alt="" src="images/image18.png" style="width: 13.33px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;is the censorship label. </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 44.00px; height: 13.33px;"><img alt="" src="images/image12.png" style="width: 44.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;if the event of interest is observed. </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 44.00px; height: 13.33px;"><img alt="" src="images/image15.png" style="width: 44.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;if the event of interest is censored. When </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 44.00px; height: 13.33px;"><img alt="" src="images/image12.png" style="width: 44.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>, </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image3.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;denotes the time to event of interest. When </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 44.00px; height: 13.33px;"><img alt="" src="images/image15.png" style="width: 44.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>, </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image3.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">&nbsp;denotes the length of time until censorship happens. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>Let&rsquo;s continue with the time-to-second ride example at Uber: if a rider took a second ride 12 days after her first ride, this observation is recorded as </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 41.33px; height: 16.00px;"><img alt="" src="images/image7.png" style="width: 41.33px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>. In another case, a rider took a first ride, 60 days have passed, and he has not yet come back to ride with us at the time of writing of research article. This observation is recorded as </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 41.33px; height: 16.00px;"><img alt="" src="images/image20.png" style="width: 41.33px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">. The situation is illustrated in the picture below. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 221.33px;"><img alt="" src="images/image2.png" style="width: 624.00px; height: 221.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">There is an ocean of survival analysis literature and over a century of statistical research already done in this area. Instead, we try to demonstrate how Pyro could help with modeling censored time to event data and extract more information out of this. </span></p><h2 class="c9" id="h.8e7ipv1wzyog"><span class="c10">Wait, how does it relate to churn modeling? </span></h2><p class="c3 c11"><span class="c2">Before proceeding, it&rsquo;s worth mentioning that many practitioners in industry circumvent this censored time to event data challenge by setting artificially defined labels as &ldquo;churn&rdquo;. For example, a eCommerce company might define a customer as &ldquo;churned&rdquo; if he / she has not yet come back to make another purchase for 40 days in a row. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">Churn modeling enable practitioners to massage observations into classical binary classification pattern. As a result, churn modeling becomes very straight forward with off-the-shelf tools like scikit-learn and XGBoost. For example, the above two riders, would be massaged into &ldquo;not churned&rdquo; and &ldquo;churned&rdquo;, respectively. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">While churn modeling admittedly works in certain situations, it does not necessarily work for Uber. For example, some hypothetical riders would only take a Uber trip when she is on business trip. And this hypothetical rider takes a trip for work every 6 months. As a result, it will be a mis-label if we categorize this rider as churned. The conclusion that we draw from a churn model would be misleading. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">Also, we are interested in making interpretations from these models to elucidate the contribution of different factors to the user behavior observed. As a result, the model should not be a black box. We would love to have the capability to open up the model and make business decisions out of it. </span></p><h1 class="c24" id="h.w8xmo8mr8tx9"><span class="c19">Okay tell me about the Pyro thing </span></h1><p class="c3 c11"><span class="c2">Pyro is a universal probabilistic programming language written in Python, supported through PyTorch as backend. It enables flexible and expressive way of conducting probabilistic modeling. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">If you come from a statistics background with minimum Bayesian modeling knowledge like me, or if you have been tinkering with deep learning tools like TensorFlow or PyTorch, you are in great luck. The following table summarizes some of the most popular projects on probabilistic programming language: &nbsp;</span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.bd920ddb650e5a538e5fd51d924d47d2147b99cb"></a><a id="t.0"></a><table class="c4"><tbody><tr class="c16"><td class="c25" colspan="1" rowspan="1"><p class="c14"><span class="c2">Name of Software</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c14"><span class="c2">BUGS / JAGS [1] </span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c14"><span class="c2">PyMC</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c14"><span class="c2">Tensorflow Probability [4] </span></p></td><td class="c15" colspan="1" rowspan="1"><p class="c14"><span class="c2">Pyro</span></p></td></tr><tr class="c16"><td class="c25" colspan="1" rowspan="1"><p class="c14"><span class="c2">Coding Language </span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c14"><span class="c2">Domain Specific Language [2] </span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c14"><span class="c2">Python</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c14"><span class="c2">Python</span></p></td><td class="c15" colspan="1" rowspan="1"><p class="c14"><span class="c2">Python</span></p></td></tr><tr class="c16"><td class="c25" colspan="1" rowspan="1"><p class="c14"><span class="c2">Underlying computational engine</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c14"><span class="c2">Self </span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c14"><span class="c2">Theano [3] &nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c14"><span class="c2">TensorFlow [5] </span></p></td><td class="c15" colspan="1" rowspan="1"><p class="c14"><span class="c2">PyTorch [6] &nbsp; </span></p></td></tr></tbody></table><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">There&rsquo;s a few things that we want to mention from the above table: </span></p><p class="c3 c6"><span class="c2"></span></p><ol class="c27 lst-kix_trzo8vq1t2jb-0 start" start="1"><li class="c3 c21 c11"><span class="c2">BUGS / JAGS are the grand daddies of modern probabilistic programming language. They have been under active development and usage for more than 2 decades in the statistical field. </span></li><li class="c3 c21 c11"><span class="c2">However, BUGS / JAGS are designed and developed mostly from ground up. As a result, model specification are done using their domain specific language. And practitioners invoke BUGS / JAGS from wrappers in R and MATLAB. This is a little bit in convenient. </span></li><li class="c3 c21 c11"><span class="c2">PyMC depends on Theano as backend. Theano used to be my favorite deep learning computation engine. However the project is recently discontinued. </span></li><li class="c3 c11 c21"><span class="c2">Tensorflow Probability (TFP) originally started as a project called Edward. The Edward project was rolled into the Tensorflow Probability project. </span></li><li class="c3 c21 c11"><span class="c2">TFP uses TensorFlow as computational engine. As a result, it supports only static computational graph.</span></li><li class="c3 c21 c11"><span class="c2">Pyro uses PyTorch as computational engine. As a result, it supports dynamic computational graph. This enables users to specify models that are diverse in terms of data structure and is very flexible. </span></li></ol><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>I know, I know, that&rsquo;s quite some information to unpack. But a short story is: </span><span class="c20">Pyro is positioned at the very beneficial intersection of the most powerful deep learning tool chain (PyTorch) while standing on the shoulder of decades of statistical research. The result is an immensely concise, powerful, yet flexible probabilistic modeling language.</span><span class="c2">&nbsp;</span></p><h1 class="c24" id="h.xmrk9riyxtjd"><span class="c19">Modeling censored time to event data</span></h1><p class="c3 c11"><span class="c2">Now let&rsquo;s finally jump into modeling censored time to event data. Many thanks to Google Colab, example of the code in this tutorial can be found on Google Colab here. Google Colab enables you to quickly get your hands dirty on modeling without even making any installation. You can duplicate the workbook and tinker around with it. </span></p><h2 class="c9" id="h.yyt9qlf24uo3"><span class="c10">Model Definition </span></h2><p class="c3 c11"><span class="c2">For illustration purpose of this blog post, the data model is defined as follows: </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>The time to event data is defined as </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 48.00px; height: 16.00px;"><img alt="" src="images/image16.png" style="width: 48.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;as mentioned before. Here </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image3.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;is time to event. </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 13.33px; height: 13.33px;"><img alt="" src="images/image18.png" style="width: 13.33px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;is a binary censoring label. Also, define the actual time to event as </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 20.00px; height: 14.67px;"><img alt="" src="images/image10.png" style="width: 20.00px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>. Note that </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 20.00px; height: 14.67px;"><img alt="" src="images/image10.png" style="width: 20.00px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;might not be observed. Define censoring time as </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 12.00px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 12.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>. For simplicity let&rsquo;s consider </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 12.00px;"><img alt="" src="images/image1.png" style="width: 12.00px; height: 12.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">&nbsp;a known fixed number. Then we have: </span></p><p class="c11 c17"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 118.67px; height: 18.67px;"><img alt="" src="images/image9.png" style="width: 118.67px; height: 18.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 109.33px; height: 18.67px;"><img alt="" src="images/image8.png" style="width: 109.33px; height: 18.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c11"><span>Also, we assume that </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 20.00px; height: 18.67px;"><img alt="" src="images/image13.png" style="width: 20.00px; height: 18.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;follow exponential distribution with scale parameter </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image14.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>. And </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image14.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;is dependent upon the following linear relationship with predictor of interest </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 16.00px; height: 13.33px;"><img alt="" src="images/image5.png" style="width: 16.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">. </span></p><p class="c17 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 160.00px; height: 18.67px;"><img alt="" src="images/image22.png" style="width: 160.00px; height: 18.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 128.00px; height: 16.00px;"><img alt="" src="images/image17.png" style="width: 128.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c11"><span>Here </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 8.00px; height: 14.67px;"><img alt="" src="images/image11.png" style="width: 8.00px; height: 14.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;is softplus function to ensure that </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image14.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;stay positive. Finally, we assume that </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 6.67px; height: 6.67px;"><img alt="" src="images/image4.png" style="width: 6.67px; height: 6.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 5.33px; height: 10.67px;"><img alt="" src="images/image6.png" style="width: 5.33px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;follow normal distribution as their prior distribution. For interpretation purpose, we are interested in evaluating the posterior distribution of </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 6.67px; height: 6.67px;"><img alt="" src="images/image4.png" style="width: 6.67px; height: 6.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 5.33px; height: 10.67px;"><img alt="" src="images/image6.png" style="width: 5.33px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">&nbsp;here.</span></p><h2 class="c9" id="h.l5omn2qhsiq"><span class="c10">Generating Artificial Data </span></h2><p class="c3 c11"><span class="c2">To import all necessary packages, we have the following cliches: </span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.cca1325ca7413c2ba4a5edc4175a4a4041e6e84c"></a><a id="t.1"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c7">import</span><span class="c1">&nbsp;pyro <br></span><span class="c7">import</span><span class="c1">&nbsp;torch <br></span><span class="c7">import</span><span class="c1">&nbsp;pyro.distributions </span><span class="c7">as</span><span class="c1">&nbsp;dist <br><br></span><span class="c7">import</span><span class="c1">&nbsp;numpy </span><span class="c7">as</span><span class="c1">&nbsp;np <br><br></span><span class="c7">import</span><span class="c1">&nbsp;seaborn </span><span class="c7">as</span><span class="c1">&nbsp;sns <br><br></span><span class="c7">from</span><span class="c1">&nbsp;pyro </span><span class="c7">import</span><span class="c1">&nbsp;infer, optim</span></p></td></tr></tbody></table><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">To generate experiment data, we have the following lines: </span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.6664faa82849a4078992a2e7bf74d0e11e0dab1b"></a><a id="t.2"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c1">n = </span><span class="c12">1000</span><span class="c1">&nbsp;<br>a = </span><span class="c12">2</span><span class="c1"><br>b = </span><span class="c12">4</span><span class="c1"><br>c = </span><span class="c12">8</span><span class="c1"><br><br>x = np.random.normal(</span><span class="c12">0</span><span class="c1">, </span><span class="c12">0.34</span><span class="c1">, n).astype(</span><span class="c0">&#39;float32&#39;</span><span class="c1">)<br><br>link = torch.nn.functional.softplus(torch.tensor(a*x + b))<br>y = np.random.exponential(link, n).astype(</span><span class="c0">&#39;float32&#39;</span><span class="c1">)<br><br>truncation_label = np.array(y &gt; c).astype(</span><span class="c0">&#39;float32&#39;</span><span class="c1">) <br><br>y_obs = np.array(list(map(</span><span class="c7">lambda</span><span class="c1">&nbsp;x: min(x,c), y))).astype(</span><span class="c0">&#39;float32&#39;</span><span class="c1">)<br><br>sns.regplot(x, y)<br>sns.regplot(x, y_obs) ## Note [1] </span></p></td></tr></tbody></table><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>At the end of the above code block (Note 1), we generated regression plot of </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 12.00px; height: 13.33px;"><img alt="" src="images/image3.png" style="width: 12.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;(green), </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 20.00px; height: 18.67px;"><img alt="" src="images/image13.png" style="width: 20.00px; height: 18.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;(blue) against </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 16.00px; height: 13.33px;"><img alt="" src="images/image5.png" style="width: 16.00px; height: 13.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">, respectively. We would see that, if we do not account for data censorship, we will underestimate the slope of model. </span></p><p class="c17 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 416.50px; height: 286.94px;"><img alt="" src="images/image21.png" style="width: 416.50px; height: 286.94px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c9" id="h.eey4drykhnnh"><span class="c10">Constructing Models </span></h2><p class="c3 c11"><span class="c2">Let&rsquo;s start with the model function below: </span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.99a17244bdcedf1363dc39a14a81e6fe336cdb1b"></a><a id="t.3"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c7">def</span><span class="c1">&nbsp;</span><span class="c13">model</span><span class="c1">(x, y, truncation_label):<br> &nbsp;a_model = pyro.sample(</span><span class="c0">&quot;a_model&quot;</span><span class="c1">, dist.Normal(</span><span class="c12">0</span><span class="c1">, </span><span class="c12">10</span><span class="c1">))<br> &nbsp;b_model = pyro.sample(</span><span class="c0">&quot;b_model&quot;</span><span class="c1">, dist.Normal(</span><span class="c12">0</span><span class="c1">, </span><span class="c12">10</span><span class="c1">))<br> &nbsp;<br> &nbsp;link = torch.nn.functional.softplus(a_model * x + b_model)<br> &nbsp;<br> &nbsp;</span><span class="c7">for</span><span class="c1">&nbsp;i </span><span class="c7">in</span><span class="c1">&nbsp;range(len(x)):<br> &nbsp; &nbsp;y_hidden_dist = dist.Exponential(</span><span class="c12">1</span><span class="c1">&nbsp;/ link[i])<br> &nbsp; &nbsp;<br> &nbsp; &nbsp;</span><span class="c7">if</span><span class="c1">&nbsp;truncation_label[i] == </span><span class="c12">0</span><span class="c1">: <br> &nbsp; &nbsp; &nbsp;y_real = pyro.sample(</span><span class="c0">&quot;obs_{}&quot;</span><span class="c1">.format(i), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y_hidden_dist,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; obs = y[i])<br> &nbsp; &nbsp;</span><span class="c7">else</span><span class="c1">:<br> &nbsp; &nbsp; &nbsp;truncation_prob = </span><span class="c12">1</span><span class="c1">&nbsp;- y_hidden_dist.cdf(y[i])<br> &nbsp; &nbsp; &nbsp;pyro.sample(</span><span class="c0">&quot;truncation_label_{}&quot;</span><span class="c1">.format(i), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dist.Bernoulli(truncation_prob), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;obs = truncation_label[i])</span></p></td></tr></tbody></table><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">There are multiple caveats of the code block above. More specifically: </span></p><h2 class="c9" id="h.qt5ee9k4lpyn"><span class="c10">Specifying Guide Function for Variational Inference </span></h2><p class="c3 c11"><span class="c2">Stochastic variational inference (SVI) is a great way to speed up Bayesian inference with large amounts of data. When I explored Pyro for the first time, I scratched my head quite a lot on why we need SVI anyway. In the end of this blog, we provided quite a few links on introducing SVI and how they relate to classical statistical methods like MCMC and Gibbs sampling. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">For now, it&rsquo;s sufficient to proceed with the knowledge that a guide function is an approximation of the desired posterior distribution. The specification of guide function could dramatically speed up the estimation of parameters. To enable stochastic variational inference, we have to define a guide function as below. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.27c91db0f03b2152a33b01173b6d1bcdddb8f383"></a><a id="t.4"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c7">def</span><span class="c1">&nbsp;</span><span class="c13">guide</span><span class="c1">(x, y, truncation_label): <br> &nbsp;a_mean = pyro.param(</span><span class="c0">&quot;a_mean&quot;</span><span class="c1">, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;torch.tensor(</span><span class="c12">1.9</span><span class="c1">))<br> &nbsp;a_std &nbsp;= pyro.param(</span><span class="c0">&quot;a_std&quot;</span><span class="c1">, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;torch.tensor(</span><span class="c12">1.</span><span class="c1">), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;constraint = constraints.positive)<br><br> &nbsp;b_mean = pyro.param(</span><span class="c0">&quot;b_mean&quot;</span><span class="c1">, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;torch.tensor(</span><span class="c12">1.2</span><span class="c1">))<br> &nbsp;b_std &nbsp;= pyro.param(</span><span class="c0">&quot;b_std&quot;</span><span class="c1">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;torch.tensor(</span><span class="c12">1.</span><span class="c1">), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;constraint = constraints.positive)<br> &nbsp;<br> &nbsp;a_model = pyro.sample(</span><span class="c0">&quot;a_model&quot;</span><span class="c1">, dist.Normal(a_mean, a_std))<br> &nbsp;b_model = pyro.sample(</span><span class="c0">&quot;b_model&quot;</span><span class="c1">, dist.Normal(b_mean, b_std))</span></p></td></tr></tbody></table><p class="c3"><span class="c2">Note that we have </span></p><h2 class="c9" id="h.e6n2umaaroci"><span class="c10">Training Model and Get Results</span></h2><p class="c3 c11"><span class="c2">The model training process is quite like classical iteration stage in most deep learning platforms. </span></p><p class="c3 c6"><span class="c2"></span></p><a id="t.1fe3e8ecd00d6421b217c97cdb04fb4eb59dbccd"></a><a id="t.5"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c1">pyro.clear_param_store()<br> &nbsp;<br>adam_params = {</span><span class="c0">&quot;lr&quot;</span><span class="c1">: </span><span class="c12">0.05</span><span class="c1">, </span><span class="c0">&quot;betas&quot;</span><span class="c1">: (</span><span class="c12">0.90</span><span class="c1">, </span><span class="c12">0.999</span><span class="c1">)}<br>optimizer = optim.Adam(adam_params)<br><br>svi = infer.SVI(model, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;guide, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;optimizer, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;loss=infer.Trace_ELBO())<br> &nbsp;<br></span><span class="c7">for</span><span class="c1">&nbsp;i </span><span class="c7">in</span><span class="c1">&nbsp;range(</span><span class="c12">1000</span><span class="c1">):<br> &nbsp;svi.step(torch.tensor(x),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; torch.tensor(y_obs), <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; torch.tensor(truncation_label))<br> &nbsp;<br> &nbsp;</span><span class="c7">if</span><span class="c1">&nbsp;i % </span><span class="c12">100</span><span class="c1">&nbsp;== </span><span class="c12">0</span><span class="c1">:<br> &nbsp; &nbsp;print(</span><span class="c0">&#39;.&#39;</span><span class="c1">,end=</span><span class="c0">&#39;&#39;</span><span class="c1">)<br> &nbsp; &nbsp;print([<br> &nbsp; &nbsp; &nbsp; &nbsp;pyro.param(</span><span class="c0">&#39;a_mean&#39;</span><span class="c1">).item(), <br> &nbsp; &nbsp; &nbsp; &nbsp;pyro.param(</span><span class="c0">&#39;a_std&#39;</span><span class="c1">).item(), <br> &nbsp; &nbsp; &nbsp; &nbsp;pyro.param(</span><span class="c0">&#39;b_mean&#39;</span><span class="c1">).item(), <br> &nbsp; &nbsp; &nbsp; &nbsp;pyro.param(</span><span class="c0">&#39;b_std&#39;</span><span class="c1">).item()])<br><br>print(</span><span class="c0">&#39;job done!&#39;</span><span class="c1">)<br>print([<br> &nbsp;pyro.param(</span><span class="c0">&#39;a_mean&#39;</span><span class="c1">).item(), <br> &nbsp;pyro.param(</span><span class="c0">&#39;a_std&#39;</span><span class="c1">).item(), <br> &nbsp;pyro.param(</span><span class="c0">&#39;b_mean&#39;</span><span class="c1">).item(), <br> &nbsp;pyro.param(</span><span class="c0">&#39;b_std&#39;</span><span class="c1">).item()])</span></p></td></tr></tbody></table><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>If everything goes on well, we could see the print out of the above execution. I got the following results, which is very close to the true value of </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 6.67px; height: 6.67px;"><img alt="" src="images/image4.png" style="width: 6.67px; height: 6.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 5.33px; height: 10.67px;"><img alt="" src="images/image6.png" style="width: 5.33px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">&nbsp;specified. </span></p><a id="t.b86ae94d148e307c1970547ba4362047e9a64fe8"></a><a id="t.6"></a><table class="c4"><tbody><tr class="c16"><td class="c5" colspan="1" rowspan="1"><p class="c3"><span class="c1">[</span><span class="c12">2.0457117557525635</span><span class="c1">, </span><span class="c12">0.38620471954345703</span><span class="c1">, </span><span class="c12">4.077511787414551</span><span class="c1">, </span><span class="c12">0.25701501965522766</span><span class="c1">]</span></p></td></tr></tbody></table><h1 class="c24" id="h.wol9yqc7u4db"><span>Where to go from here? </span><sup><a href="#cmnt1" id="cmnt_ref1">[a]</a></sup></h1><p class="c3 c11"><span class="c2">There are many powerful features on stochastic variational inference. If you come from a statistics background like I do, you might have found the terminology a bit strange at the very beginning. Fortunately, here is a very good article to get you familiar with the method. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span>You might also ask if the guide function is a good approximation of posterior distribution of </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 6.67px; height: 6.67px;"><img alt="" src="images/image4.png" style="width: 6.67px; height: 6.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 5.33px; height: 10.67px;"><img alt="" src="images/image6.png" style="width: 5.33px; height: 10.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c2">. You can find answers to these questions in the above document as well. &nbsp;</span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">I hope you are excited about the capability of Pyro. You can get started here. </span></p><p class="c3 c6"><span class="c2"></span></p><p class="c3 c11"><span class="c2">Finally, we have job openings on product teams as well as AI labs. Come join us here. </span></p><div class="c29"><p class="c14"><a href="#cmnt_ref1" id="cmnt1">[a]</a><span class="c2">I&#39;ll add more stuff here</span></p></div></body></html>